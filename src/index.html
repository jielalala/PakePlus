<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>波士顿房价预测系统</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-router@3.5.3/dist/vue-router.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(120deg, #84fab0 0%, #8fd3f4 100%);
        }
        .card {
            backdrop-filter: blur(10px);
            background-color: rgba(255, 255, 255, 0.9);
        }
        .input-field {
            transition: all 0.3s ease;
        }
        .input-field:focus {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .nav-link {
            transition: all 0.3s ease;
        }
        .nav-link:hover {
            transform: translateY(-2px);
        }
        .page-enter-active, .page-leave-active {
            transition: opacity 0.5s;
        }
        .page-enter, .page-leave-to {
            opacity: 0;
        }
        .hero-section {
            background-image: url('https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80');
            background-size: cover;
            background-position: center;
            height: 60vh;
            position: relative;
        }
        .hero-overlay {
            background: rgba(0, 0, 0, 0.5);
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }
        .feature-card {
            transition: all 0.3s ease;
        }
        .feature-card:hover {
            transform: translateY(-5px);
        }
        .model-card {
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.95);
        }
        .model-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .scroll-section {
            scroll-behavior: smooth;
        }
        .main-content {
            padding-top: 80px; /* 导航栏高度+间距，确保内容不被遮挡 */
        }
    </style>
</head>
<body class="min-h-screen gradient-bg">
    <div id="app">
        <!-- 导航栏 -->
        <nav class="bg-white bg-opacity-90 shadow-lg fixed w-full z-50">
            <div class="container mx-auto px-4">
                <div class="flex justify-between items-center py-4">
                    <router-link to="/" class="text-2xl font-bold text-blue-600">波士顿房价预测</router-link>
                    <div class="space-x-4">
                        <router-link to="/" class="nav-link text-gray-600 hover:text-blue-600">首页</router-link>
                        <router-link to="/xgboost" class="nav-link text-gray-600 hover:text-blue-600">XGBoost预测</router-link>
                        <router-link to="/randomforest" class="nav-link text-gray-600 hover:text-blue-600">随机森林预测</router-link>
                        <router-link to="/svm" class="nav-link text-gray-600 hover:text-blue-600">SVM预测</router-link>
                    </div>
                </div>
            </div>
        </nav>

        <!-- 页面内容 -->
        <transition name="page" mode="out-in">
            <router-view></router-view>
        </transition>
    </div>

    <!-- 首页组件 -->
    <script type="text/x-template" id="home-template">
        <div class="scroll-section main-content">
            <!-- 英雄区域 -->
            <div class="hero-section">
                <div class="hero-overlay flex items-center justify-center">
                    <div class="text-center text-white">
                        <h1 class="text-5xl font-bold mb-4">波士顿房价预测系统</h1>
                        <p class="text-xl mb-8">基于机器学习的智能房价预测平台</p>
                        <router-link to="/xgboost" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg transition duration-300 transform hover:scale-105">
                            开始预测
                        </router-link>
                    </div>
                </div>
            </div>

            <!-- 系统特点 -->
            <div class="container mx-auto px-4 py-16">
                <h2 class="text-3xl font-bold text-center text-gray-800 mb-12">系统特点</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="feature-card bg-white rounded-lg shadow-lg p-6 text-center">
                        <img src="https://images.unsplash.com/photo-1551288049-bebda4e38f71?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="多种模型" class="w-32 h-32 mx-auto mb-4 rounded-full object-cover">
                        <h3 class="text-xl font-semibold mb-2">多种机器学习模型</h3>
                        <p class="text-gray-600">支持XGBoost、随机森林、SVM等多种先进算法</p>
                    </div>
                    <div class="feature-card bg-white rounded-lg shadow-lg p-6 text-center">
                        <img src="https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="高精度预测" class="w-32 h-32 mx-auto mb-4 rounded-full object-cover">
                        <h3 class="text-xl font-semibold mb-2">高精度预测</h3>
                        <p class="text-gray-600">基于大量历史数据的精确预测结果</p>
                    </div>
                    <div class="feature-card bg-white rounded-lg shadow-lg p-6 text-center">
                        <img src="https://images.unsplash.com/photo-1551434678-e076c223a692?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="用户友好" class="w-32 h-32 mx-auto mb-4 rounded-full object-cover">
                        <h3 class="text-xl font-semibold mb-2">用户友好界面</h3>
                        <p class="text-gray-600">直观的操作界面，轻松获取预测结果</p>
                    </div>
                </div>
            </div>

            <!-- 可用模型 -->
            <div class="bg-gray-100 py-16">
                <div class="container mx-auto px-4">
                    <h2 class="text-3xl font-bold text-center text-gray-800 mb-12">可用模型</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <router-link to="/xgboost" class="model-card rounded-lg shadow-lg p-6">
                            <img src="https://images.unsplash.com/photo-1551288049-bebda4e38f71?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="XGBoost" class="w-full h-48 object-cover rounded-lg mb-4">
                            <h3 class="text-xl font-semibold mb-2">XGBoost模型</h3>
                            <p class="text-gray-600">基于梯度提升的高性能模型，适合处理复杂的非线性关系</p>
                        </router-link>
                        <router-link to="/randomforest" class="model-card rounded-lg shadow-lg p-6">
                            <img src="https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="随机森林" class="w-full h-48 object-cover rounded-lg mb-4">
                            <h3 class="text-xl font-semibold mb-2">随机森林模型</h3>
                            <p class="text-gray-600">集成多个决策树的稳定模型，具有优秀的泛化能力</p>
                        </router-link>
                        <router-link to="/svm" class="model-card rounded-lg shadow-lg p-6">
                            <img src="https://images.unsplash.com/photo-1551434678-e076c223a692?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="SVM" class="w-full h-48 object-cover rounded-lg mb-4">
                            <h3 class="text-xl font-semibold mb-2">SVM模型</h3>
                            <p class="text-gray-600">支持向量机回归模型，适合处理高维数据</p>
                        </router-link>
                    </div>
                </div>
            </div>

            <!-- 使用流程 -->
            <div class="container mx-auto px-4 py-16">
                <h2 class="text-3xl font-bold text-center text-gray-800 mb-12">使用流程</h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center text-white text-2xl font-bold mx-auto mb-4">1</div>
                        <h3 class="text-xl font-semibold mb-2">选择模型</h3>
                        <p class="text-gray-600">根据需求选择合适的预测模型</p>
                    </div>
                    <div class="text-center">
                        <div class="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center text-white text-2xl font-bold mx-auto mb-4">2</div>
                        <h3 class="text-xl font-semibold mb-2">输入数据</h3>
                        <p class="text-gray-600">填写相关特征数据</p>
                    </div>
                    <div class="text-center">
                        <div class="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center text-white text-2xl font-bold mx-auto mb-4">3</div>
                        <h3 class="text-xl font-semibold mb-2">获取预测</h3>
                        <p class="text-gray-600">系统自动计算预测结果</p>
                    </div>
                    <div class="text-center">
                        <div class="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center text-white text-2xl font-bold mx-auto mb-4">4</div>
                        <h3 class="text-xl font-semibold mb-2">查看结果</h3>
                        <p class="text-gray-600">查看详细的预测结果</p>
                    </div>
                </div>
            </div>
        </div>
    </script>

    <!-- 预测页面组件 -->
    <script type="text/x-template" id="predict-template">
        <div class="main-content container mx-auto px-4 py-8">
            <div class="max-w-4xl mx-auto">
                <!-- Excel上传功能 -->
                <div class="card rounded-lg shadow-xl p-6 mb-8">
                    <h2 class="text-2xl font-semibold mb-4 text-gray-800 text-center">{{ pageTitle }}</h2>
                    <div class="mb-6 flex flex-col md:flex-row md:items-center md:justify-between">
                        <label class="block text-gray-700 font-medium mb-2 md:mb-0">批量预测：</label>
                        <input type="file" accept=".xlsx,.xls" @change="handleFileUpload" ref="fileInput" class="block w-full md:w-auto border border-gray-300 rounded-lg px-3 py-2" />
                    </div>
                    <div v-if="excelResults.length" class="mb-6 overflow-x-auto">
                        <table class="min-w-full bg-white rounded-lg shadow">
                            <thead>
                                <tr>
                                    <th v-for="key in orderedExcelKeys" :key="key" class="px-4 py-2 border-b text-gray-700">{{ key }}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="(row, idx) in excelResults" :key="idx">
                                    <td v-for="key in orderedExcelKeys" :key="key" class="px-4 py-2 border-b">{{ row[key] }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- 原有表单 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div v-for="(desc, feature) in featureDescriptions" :key="feature" class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">{{ feature }}</label>
                            <input 
                                type="number" 
                                v-model="inputData[feature]" 
                                class="input-field w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                :placeholder="desc"
                                step="any"
                            >
                        </div>
                    </div>
                    <div class="mt-6 text-center">
                        <button 
                            @click="predict" 
                            class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg transition duration-300 transform hover:scale-105"
                            :disabled="isLoading"
                        >
                            {{ isLoading ? '预测中...' : '开始预测' }}
                        </button>
                    </div>
                </div>
                <div v-if="prediction" class="card rounded-lg shadow-xl p-6">
                    <h2 class="text-2xl font-semibold mb-4 text-gray-800 text-center">预测结果</h2>
                    <div class="text-center">
                        <div class="text-4xl font-bold text-blue-600 mb-2">
                            ${{ formatPrice(prediction) }}
                        </div>
                        <p class="text-gray-600">预测房价中位数</p>
                    </div>
                </div>
                <div v-if="error" class="mt-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg">
                    {{ error }}
                </div>
            </div>
        </div>
    </script>

    <script>
        // 首页组件
        const Home = {
            template: '#home-template'
        };

        // 预测页面组件
        const PredictPage = {
            template: '#predict-template',
            data() {
                return {
                    inputData: {},
                    featureDescriptions: {},
                    prediction: null,
                    error: null,
                    isLoading: false,
                    excelResults: [],
                    orderedExcelKeys: []
                }
            },
            computed: {
                pageTitle() {
                    const map = {
                        xgboost: 'XGBoost预测',
                        randomforest: '随机森林预测',
                        svm: 'SVM预测'
                    };
                    return map[this.$route.name] || '模型预测';
                }
            },
            created() {
                this.resetAll();
                this.fetchFeatures();
            },
            watch: {
                '$route.name'() {
                    this.resetAll();
                    this.fetchFeatures();
                }
            },
            methods: {
                resetAll() {
                    this.inputData = {};
                    this.prediction = null;
                    this.error = null;
                    this.isLoading = false;
                    this.excelResults = [];
                    this.orderedExcelKeys = [];
                    if (this.$refs.fileInput) {
                        this.$refs.fileInput.value = '';
                    }
                },
                async fetchFeatures() {
                    try {
                        const response = await axios.get('http://localhost:5000/api/features');
                        this.featureDescriptions = response.data.descriptions;
                        response.data.features.forEach(feature => {
                            this.inputData[feature] = '';
                        });
                    } catch (error) {
                        this.error = '获取特征信息失败';
                    }
                },
                async predict() {
                    this.isLoading = true;
                    this.error = null;
                    this.prediction = null;
                    try {
                        const modelType = this.$route.name;
                        const response = await axios.post(`http://localhost:5000/api/predict/${modelType}`, this.inputData);
                        this.prediction = response.data.prediction;
                    } catch (error) {
                        this.error = error.response?.data?.error || '预测失败，请检查输入数据';
                    } finally {
                        this.isLoading = false;
                    }
                },
                formatPrice(price) {
                    return new Intl.NumberFormat('en-US').format(Math.round(price * 1000));
                },
                async handleFileUpload(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    const formData = new FormData();
                    formData.append('file', file);
                    try {
                        const modelType = this.$route.name;
                        const response = await axios.post(`http://localhost:5000/api/predict_excel/${modelType}`, formData, {
                            headers: { 'Content-Type': 'multipart/form-data' }
                        });
                        this.excelResults = response.data.results;
                        if (this.excelResults.length) {
                            const keys = Object.keys(this.excelResults[0]);
                            const filtered = keys.filter(k => k !== '预测房价');
                            this.orderedExcelKeys = [...filtered, '预测房价'];
                        } else {
                            this.orderedExcelKeys = [];
                        }
                        this.error = null;
                    } catch (error) {
                        this.error = error.response?.data?.error || 'Excel批量预测失败';
                        this.excelResults = [];
                        this.orderedExcelKeys = [];
                    }
                }
            }
        };

        // 路由配置
        const routes = [
            { path: '/', component: Home },
            { path: '/xgboost', component: PredictPage, name: 'xgboost' },
            { path: '/randomforest', component: PredictPage, name: 'randomforest' },
            { path: '/svm', component: PredictPage, name: 'svm' }
        ];

        const router = new VueRouter({
            routes
        });

        new Vue({
            el: '#app',
            router
        });
    </script>
</body>
</html> 